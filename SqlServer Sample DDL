-- ********************* SqlDBM: Microsoft SQL Server ********************
-- * Generated by SqlDBM: SqlServer sample, v5 by hazal.sener@sqldbm.com *


-- ************************************** [dbo].[Supplier]
CREATE TABLE [dbo].[Supplier]
(
 [SupplierId]  int IDENTITY (1, 1) NOT NULL ,
 [CompanyName] nvarchar(40) NOT NULL ,
 [Phone]       nvarchar(20) NULL ,


 CONSTRAINT [PK_Supplier] PRIMARY KEY CLUSTERED ([SupplierId] ASC),
 CONSTRAINT [AK1_Supplier_CompanyName] UNIQUE NONCLUSTERED ([CompanyName] ASC)
);
GO



EXEC sp_addextendedproperty @name = N'MS_Description', @value = N'Basic information 
about Supplier', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Supplier';
GO
-- ************************************** [dbo].[Customer]
CREATE TABLE [dbo].[Customer]
(
 [CustomerId]   int IDENTITY (1, 1) NOT NULL ,
 [CustomerName] nvarchar(40) NOT NULL ,
 [Phone]        nvarchar(20) NULL ,


 CONSTRAINT [PK_Customer] PRIMARY KEY CLUSTERED ([CustomerId] ASC),
 CONSTRAINT [AK1_Customer_CustomerName] UNIQUE NONCLUSTERED ([CustomerName] ASC)
);
GO



EXEC sp_addextendedproperty @name = N'MS_Description', @value = N'Basic information 
about Customer', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Customer';
GO
-- ************************************** [dbo].[Product]
CREATE TABLE [dbo].[Product]
(
 [ProductId]      int IDENTITY (1, 1) NOT NULL ,
 [ProductName]    nvarchar(50) NOT NULL ,
 [SupplierId]     int NOT NULL ,
 [UnitPrice]      decimal(12,2) NULL ,
 [IsDiscontinued] bit NOT NULL CONSTRAINT [DF_Product_IsDiscontinued] DEFAULT ((0)) ,


 CONSTRAINT [PK_Product] PRIMARY KEY CLUSTERED ([ProductId] ASC),
 CONSTRAINT [AK1_Product_SupplierId_ProductName] UNIQUE NONCLUSTERED ([SupplierId] ASC, [ProductName] ASC),
 CONSTRAINT [FK_Product_SupplierId_Supplier] FOREIGN KEY ([SupplierId])  REFERENCES [dbo].[Supplier]([SupplierId])
);
GO


CREATE NONCLUSTERED INDEX [fkIdx_FK_Product_SupplierId_Supplier_hz] ON [dbo].[Product] 
 (
  [SupplierId] ASC
 )

GO


EXEC sp_addextendedproperty @name = N'MS_Description', @value = N'Basic information 
about Product', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Product';
GO
-- ************************************** [dbo].[Order]
CREATE TABLE [dbo].[Order]
(
 [OrderId]     int IDENTITY (1, 1) NOT NULL ,
 [OrderNumber] nvarchar(10) NULL ,
 [CustomerId]  int NOT NULL ,
 [OrderDate]   datetime NOT NULL CONSTRAINT [DF_Order_OrderDate] DEFAULT (getdate()) ,
 [TotalAmount] decimal(12,2) NOT NULL ,


 CONSTRAINT [PK_Order] PRIMARY KEY CLUSTERED ([OrderId] ASC),
 CONSTRAINT [AK1_Order_OrderNumber] UNIQUE NONCLUSTERED ([OrderNumber] ASC),
 CONSTRAINT [FK_Order_CustomerId_Customer] FOREIGN KEY ([CustomerId])  REFERENCES [dbo].[Customer]([CustomerId])
);
GO


CREATE NONCLUSTERED INDEX [fkIdx_FK_Order_CustomerId_Customer_hz] ON [dbo].[Order] 
 (
  [CustomerId] ASC
 )

GO


EXEC sp_addextendedproperty @name = N'MS_Description', @value = N'Order information
like Date, Amount', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'Order';
GO
-- ************************************** [dbo].[OrderItem]
CREATE TABLE [dbo].[OrderItem]
(
 [OrderId]   int NOT NULL ,
 [ProductId] int NOT NULL ,
 [UnitPrice] decimal(12,2) NOT NULL ,
 [Quantity]  int NOT NULL ,


 CONSTRAINT [PK_OrderItem] PRIMARY KEY CLUSTERED ([OrderId] ASC, [ProductId] ASC),
 CONSTRAINT [FK_OrderItem_OrderId_Order] FOREIGN KEY ([OrderId])  REFERENCES [dbo].[Order]([OrderId]),
 CONSTRAINT [FK_OrderItem_ProductId_Product] FOREIGN KEY ([ProductId])  REFERENCES [dbo].[Product]([ProductId])
);
GO


CREATE NONCLUSTERED INDEX [fkIdx_FK_OrderItem_OrderId_Order_hz] ON [dbo].[OrderItem] 
 (
  [OrderId] ASC
 )

GO

CREATE NONCLUSTERED INDEX [fkIdx_FK_OrderItem_ProductId_Product_hz] ON [dbo].[OrderItem] 
 (
  [ProductId] ASC
 )

GO


EXEC sp_addextendedproperty @name = N'MS_Description', @value = N'Information about
like Price, Quantity', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'OrderItem';
GO
-- ************************************** [view_1]
CREATE VIEW [view_1]
AS SELECT *
  from dbo.Order
NULL;
GO

CREATE TABLE dbo.SalesSummary (
    product_id INT PRIMARY KEY,          -- Unique identifier for each product
    sale_count BIGINT NOT NULL,          -- Total number of sales for the product
    total_sales DECIMAL(18, 2) NOT NULL  -- Sum of all sales amounts for the product
);

CREATE VIEW dbo.sales_data_v
WITH SCHEMABINDING
AS
SELECT 
    s.product_id,
    COUNT_BIG(*) AS sale_count,  -- Required for indexed views
    SUM(s.sale_amount) AS total_sales
FROM 
    dbo.sales_data s
GROUP BY 
    s.product_id;
GO

CREATE UNIQUE CLUSTERED INDEX IX_SalesSummary
ON dbo.SalesSummary (product_id);
GO

CREATE TABLE dbo.sales_data (
    sale_id INT PRIMARY KEY IDENTITY(1,1),   -- Unique identifier for each sale
    product_id INT NOT NULL,                 -- References the product sold
    customer_id INT NOT NULL,                -- References the customer who made the purchase
    sale_amount DECIMAL(18, 2) NOT NULL,     -- The monetary amount of the sale
    sale_date DATE NOT NULL,                 -- The date of the sale
);


